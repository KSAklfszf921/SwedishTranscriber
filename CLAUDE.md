# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

SwedishTranscriber is a macOS application for transcribing Swedish speech using KBLab's optimized Whisper models. The project leverages:

- **whisper.cpp** for high-performance inference
- **Core ML and Metal** for Apple Silicon optimization  
- **KBLab's Swedish Whisper models** for improved Swedish language accuracy
- **Swift/SwiftUI** for the macOS user interface

## Build System

The project uses a comprehensive bash build script (`build.script.sh`) that:

1. **Dependency Management**: Checks for cmake, ninja, ffmpeg, python3
2. **External Dependencies**: Clones and builds whisper.cpp with Core ML/Metal support
3. **Model Management**: Downloads and converts KBLab Swedish Whisper models
4. **Swift Build**: Uses xcodebuild to compile and archive the macOS app

### Build Commands

```bash
# Full build process
./build.script.sh

# Prerequisites check
brew install cmake ninja ffmpeg

# The script handles:
# - whisper.cpp compilation with Core ML/Metal/Accelerate support
# - Python dependencies: ane_transformers openai-whisper coremltools numpy torch huggingface_hub
# - Swift app compilation and archiving with xcodebuild
# - Model downloading from KBLab's HuggingFace repository
# - Automatic creation of ExportOptions.plist for app distribution
```

## Architecture

### Core Components (Generated by build script)
- **whisper.cpp integration**: C++ library for speech recognition inference
- **Core ML models**: Optimized versions of KBLab Swedish Whisper models
- **Swift application**: macOS GUI built with SwiftUI
- **Python scripts**: Model downloading and conversion utilities

### Model Pipeline
1. KBLab Whisper models from HuggingFace Hub
2. Core ML conversion for Apple Silicon optimization
3. Integration with whisper.cpp for inference
4. Swift interface for user interaction

### File Structure (Generated)
```
lib/whisper.cpp/          # whisper.cpp C++ library
models/                   # Core ML model files
scripts/                  # Python utilities
build/                    # Build artifacts
```

## Development Workflow

### Prerequisites
- macOS 13.0+ (Ventura or later)
- Xcode with Swift support
- Apple Silicon Mac (recommended) or Intel Mac with AVX
- Homebrew dependencies: cmake, ninja, ffmpeg

### Model Development
- Models sourced from KBLab's HuggingFace repository
- Conversion handled by `scripts/download_kb_model.py`
- Core ML optimization for Neural Engine acceleration

### Performance Targets
- Apple Silicon: 15-50x realtime depending on model size
- Intel Mac: 3-10x realtime with AVX optimization

## Key Technical Details

- **Whisper.cpp version**: Pinned to v1.7.2 for stability
- **Model formats**: Core ML (.mlmodelc) for Apple Silicon optimization
- **Audio processing**: FFmpeg for format support
- **Parallel processing**: Multiple file transcription support
- **Output formats**: Text, SRT, VTT, JSON with timestamps
- **Distribution**: Uses Developer ID Application signing for distribution outside App Store

## Build Artifacts

After successful build:
- **App location**: `build/Release/SwedishTranscriber.app`
- **Archive**: `build/SwedishTranscriber.xcarchive`
- **Models cache**: `~/Library/Application Support/SwedishTranscriber/Models`